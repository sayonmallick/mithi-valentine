<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Valentine üíñ</title>

  <style>
    html, body { height: 100%; margin: 0; }
    body {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #ffe6ec;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    h1 { color: #d1004f; margin-bottom: 40px; text-align: center; }

    .buttons {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    button {
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }

    #yes {
      background: #ff2f6d;
      color: white;
    }

    /* "No" floats across the whole viewport */
    #no {
      background: #555;
      color: white;
      position: fixed;
      transition: left 140ms ease, top 140ms ease;
      left: 60%;
      top: 50%;
    }

    button:focus {
      outline: 3px solid rgba(209,0,79,0.25);
      outline-offset: 4px;
    }

    /* sticker/overlay shown after "Yes" */
    #sticker {
      position: fixed;
      left: 50%;
      top: 45%;
      transform: translate(-50%, -50%) scale(0.9);
      max-width: 70%;
      max-height: 60%;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease, transform 300ms cubic-bezier(.2,.9,.2,1);
      z-index: 9999;
    }
    #sticker.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
  </style>
</head>

<body>

  <h1>Will you be my Valentine? üíò</h1>

  <div class="buttons">
    <button id="yes" type="button" aria-label="Yes ‚Äî open link in new tab">Yes ‚ù§Ô∏è</button>
    <button id="no" type="button" aria-label="No, I will not be your valentine">No üòú</button>
  </div>

  <!-- Sticker image: replace the file in the repo and update stickerSrc in the script if needed -->
  <img id="sticker" src="sticker.png" alt="Sticker">

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    // ===== config =====
    // The URL to open in a new tab on Yes:
    const targetUrl = "https://sayonmallick.github.io/mithi-valentine/";

    // Sticker filename in the repo root (change to your uploaded image filename)
    // By default it's "sticker.png". To use your own photo, upload e.g. "myphoto.jpg"
    // to the repo root and set stickerSrc = "myphoto.jpg"
    const stickerSrc = "myphoto.jpg";

    // ===== elements =====
    const noBtn = document.getElementById("no");
    const yesBtn = document.getElementById("yes");
    const sticker = document.getElementById("sticker");

    // set sticker src (so you can change just the variable)
    sticker.src = stickerSrc;

    // ===== "No" button: move anywhere on viewport, but clicks do nothing =====
    function moveNo() {
      const padding = 12;
      const btnWidth = noBtn.offsetWidth || 100;
      const btnHeight = noBtn.offsetHeight || 40;

      const maxX = Math.max(window.innerWidth - btnWidth - padding, padding);
      const maxY = Math.max(window.innerHeight - btnHeight - padding, padding);

      const x = Math.random() * (maxX - padding) + padding;
      const y = Math.random() * (maxY - padding) + padding;

      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
    }

    // Move on mouse hover
    noBtn.addEventListener("pointerenter", moveNo);
    // Also move on touch (mobile)
    noBtn.addEventListener("touchstart", (e) => {
      // prevent the touch from immediately triggering a "click"
      e.preventDefault();
      moveNo();
    }, {passive: false});

    // Make clicks on "No" do nothing (so it's effectively not clickable)
    noBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      // optional: move again on click to be extra sneaky
      moveNo();
    });

    // Keep keyboard users able to focus (but we won't trigger a "No" action)
    noBtn.addEventListener("keydown", (e) => {
      // If user presses Enter or Space, prevent default to avoid accidental activation
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        moveNo();
      }
    });

    // Initial placement (center-right-ish)
    window.addEventListener('load', () => {
      const left = Math.min(window.innerWidth - noBtn.offsetWidth - 24, window.innerWidth * 0.7);
      const top = Math.min(window.innerHeight - noBtn.offsetHeight - 24, window.innerHeight * 0.45);
      noBtn.style.left = (left || 300) + 'px';
      noBtn.style.top = (top || 200) + 'px';
    });

    // Keep it inside viewport on resize
    window.addEventListener('resize', () => {
      const padding = 12;
      const left = parseFloat(getComputedStyle(noBtn).left) || 0;
      const top = parseFloat(getComputedStyle(noBtn).top) || 0;
      const maxLeft = Math.max(window.innerWidth - noBtn.offsetWidth - padding, padding);
      const maxTop = Math.max(window.innerHeight - noBtn.offsetHeight - padding, padding);
      if (left > maxLeft) noBtn.style.left = maxLeft + 'px';
      if (top > maxTop) noBtn.style.top = maxTop + 'px';
    });

    // ===== confetti (firecracker bursts) =====
    function firecrackerBurst() {
      if (typeof confetti !== "function") return;
      const colors = [
        ['#ff2f6d', '#ffd700', '#ff7f50'],
        ['#ffb3c6', '#ffffff', '#ffd700'],
        ['#00aaff', '#a0e9ff', '#ffffff'],
      ];
      const bursts = [
        { delay:   0, particleCount: 70, spread: 30, startVelocity: 80 },
        { delay: 120, particleCount: 60, spread: 45, startVelocity: 60 },
        { delay: 240, particleCount: 80, spread: 60, startVelocity: 90 },
        { delay: 360, particleCount: 100, spread: 100, startVelocity: 40 },
      ];
      bursts.forEach((b, i) => {
        setTimeout(() => {
          confetti({
            particleCount: b.particleCount,
            angle: 90,
            spread: b.spread,
            startVelocity: b.startVelocity,
            ticks: 200,
            origin: { x: 0.5 + (Math.random() - 0.5) * 0.2, y: 0.25 + (Math.random() - 0.2) * 0.2 },
            colors: colors[i % colors.length],
            scalar: 1 + Math.random() * 0.3,
          });
        }, b.delay);
      });
      setTimeout(() => {
        confetti({
          particleCount: 180,
          spread: 160,
          startVelocity: 30,
          ticks: 220,
          origin: { x: 0.5, y: 0.4 },
          colors: ['#ff2f6d', '#ffd700', '#fff', '#ff7f50', '#00aaff'],
        });
      }, 520);
    }

    // ===== sound (WebAudio) =====
    let audioCtx = null;
    function playFirecrackerSound() {
      try {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const ctx = audioCtx;
        const master = ctx.createGain();
        master.gain.value = 0.9;
        master.connect(ctx.destination);

        const bufferSize = ctx.sampleRate * 0.2;
        const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
        const data = noiseBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * Math.exp(-3 * i / bufferSize);
        }
        const noise = ctx.createBufferSource();
        noise.buffer = noiseBuffer;
        const noiseFilter = ctx.createBiquadFilter();
        noiseFilter.type = 'highpass';
        noiseFilter.frequency.value = 900;
        noise.connect(noiseFilter);
        noiseFilter.connect(master);

        const osc = ctx.createOscillator();
        const oscGain = ctx.createGain();
        osc.type = 'triangle';
        osc.frequency.value = 1200;
        oscGain.gain.value = 0.0001;
        osc.connect(oscGain);
        oscGain.connect(master);

        const now = ctx.currentTime;
        noise.start(now);
        noise.stop(now + 0.18);

        osc.start(now);
        osc.frequency.exponentialRampToValueAtTime(600, now + 0.08);
        oscGain.gain.setValueAtTime(0.0001, now);
        oscGain.gain.exponentialRampToValueAtTime(0.6, now + 0.005);
        oscGain.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);
        osc.stop(now + 0.14);
      } catch (err) {
        console.warn('Audio not available:', err);
      }
    }

    // ===== show sticker overlay =====
    function showSticker(duration = 3500) {
      if (!sticker) return;
      // ensure sticker is visible (in case src loads slowly)
      sticker.classList.add('show');
      setTimeout(() => {
        sticker.classList.remove('show');
      }, duration);
    }

    // ===== Yes click: open tab + confetti + sound + sticker =====
    yesBtn.addEventListener("click", () => {
      // Open new tab first (user gesture)
      window.open(targetUrl, "_blank", "noopener,noreferrer");

      // Firecracker burst + sound + sticker
      firecrackerBurst();
      playFirecrackerSound();
      showSticker(3800);
    });
  </script>

</body>
</html>
